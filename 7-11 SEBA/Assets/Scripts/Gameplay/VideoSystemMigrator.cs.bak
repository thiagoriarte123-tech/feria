using UnityEngine;

/// <summary>
/// Migra automÃ¡ticamente del sistema de video anterior al nuevo sistema limpio
/// Ejecutar una vez para limpiar y configurar todo
/// </summary>
public class VideoSystemMigrator : MonoBehaviour
{
    [Header("Migration Settings")]
    public bool autoMigrateOnStart = true;
    public bool removeOldScripts = true;
    public bool setupNewSystem = true;
    
    void Start()
    {
        if (autoMigrateOnStart)
        {
            MigrateVideoSystem();
        }
    }
    
    [ContextMenu("Migrate Video System")]
    public void MigrateVideoSystem()
    {
        Debug.Log("ğŸ”„ Iniciando migraciÃ³n del sistema de video...");
        
        if (removeOldScripts)
        {
            RemoveOldVideoScripts();
        }
        
        if (setupNewSystem)
        {
            SetupNewVideoSystem();
        }
        
        ConnectToGameplayManager();
        
        Debug.Log("âœ… MigraciÃ³n del sistema de video completada");
    }
    
    void RemoveOldVideoScripts()
    {
        Debug.Log("ğŸ—‘ï¸ Removiendo scripts de video obsoletos...");
        
        // Find and disable old video scripts
        BackgroundVideoManager[] oldManagers = FindObjectsOfType<BackgroundVideoManager>();
        foreach (var manager in oldManagers)
        {
            manager.enabled = false;
            Debug.Log($"ğŸ—‘ï¸ Desactivado: {manager.name}");
        }
        
        VideoSetupHelper[] helpers = FindObjectsOfType<VideoSetupHelper>();
        foreach (var helper in helpers)
        {
            helper.enabled = false;
            Debug.Log($"ğŸ—‘ï¸ Desactivado: {helper.name}");
        }
        
        FullScreenVideoBackground[] backgrounds = FindObjectsOfType<FullScreenVideoBackground>();
        foreach (var bg in backgrounds)
        {
            bg.enabled = false;
            Debug.Log($"ğŸ—‘ï¸ Desactivado: {bg.name}");
        }
        
        VideoFormatOptimizer[] optimizers = FindObjectsOfType<VideoFormatOptimizer>();
        foreach (var opt in optimizers)
        {
            opt.enabled = false;
            Debug.Log($"ğŸ—‘ï¸ Desactivado: {opt.name}");
        }
        
        QuickGameplayFix[] fixes = FindObjectsOfType<QuickGameplayFix>();
        foreach (var fix in fixes)
        {
            fix.enabled = false;
            Debug.Log($"ğŸ—‘ï¸ Desactivado: {fix.name}");
        }
    }
    
    void SetupNewVideoSystem()
    {
        Debug.Log("ğŸ†• Configurando nuevo sistema de video...");
        
        // Find or create BackgroundVideoManager
        BackgroundVideoManager newManager = FindFirstObjectByType<BackgroundVideoManager>();
        
        if (newManager == null)
        {
            GameObject managerObj = new GameObject("BackgroundVideoManager");
            newManager = managerObj.AddComponent<BackgroundVideoManager>();
            Debug.Log("ğŸ†• BackgroundVideoManager creado");
        }
        
        // Configure for optimal performance
        newManager.enableBackgroundVideo = true;
        newManager.videoOpacity = 0.8f;
        // newManager.videoLoadTimeout = 5f; // Not available in original
        // newManager.autoSetupOnStart = true; // Not available in original
        // newManager.debugMode = true; // Not available in original
        
        // Setup the video system
        // newManager.SetupVideoSystem(); // Not available in original
        
        Debug.Log("âœ… Nuevo sistema de video configurado");
    }
    
    void ConnectToGameplayManager()
    {
        Debug.Log("ğŸ”— Conectando con GameplayManager...");
        
        GameplayManager gameplayManager = FindFirstObjectByType<GameplayManager>();
        BackgroundVideoManager videoManager = FindFirstObjectByType<BackgroundVideoManager>();
        
        if (gameplayManager != null && videoManager != null)
        {
            gameplayManager.backgroundVideoManager = videoManager;
            Debug.Log("âœ… GameplayManager conectado con BackgroundVideoManager");
        }
        else
        {
            if (gameplayManager == null)
                Debug.LogWarning("âš ï¸ GameplayManager no encontrado");
            if (videoManager == null)
                Debug.LogWarning("âš ï¸ BackgroundVideoManager no encontrado");
        }
    }
    
    [ContextMenu("Clean Project")]
    public void CleanProject()
    {
        Debug.Log("ğŸ§¹ Limpiando proyecto de scripts obsoletos...");
        
        // List all obsolete scripts that can be safely removed
        Debug.Log("ğŸ“‹ SCRIPTS OBSOLETOS QUE PUEDES ELIMINAR:");
        Debug.Log("   â€¢ BackgroundVideoManager.cs (original)");
        Debug.Log("   â€¢ VideoSetupHelper.cs");
        Debug.Log("   â€¢ FullScreenVideoBackground.cs");
        Debug.Log("   â€¢ VideoFormatOptimizer.cs");
        Debug.Log("   â€¢ QuickGameplayFix.cs");
        Debug.Log("   â€¢ README_BackgroundVideos.md");
        Debug.Log("");
        Debug.Log("ğŸ“‹ SCRIPTS NECESARIOS:");
        Debug.Log("   âœ… BackgroundVideoManager.cs");
        Debug.Log("   âœ… GameplayManager.cs (modificado)");
        Debug.Log("   âœ… VideoSystemMigrator.cs (este script)");
    }
    
    [ContextMenu("Test Video System")]
    public void TestVideoSystem()
    {
        Debug.Log("ğŸ§ª Probando sistema de video...");
        
        BackgroundVideoManager videoManager = FindFirstObjectByType<BackgroundVideoManager>();
        if (videoManager != null)
        {
            Debug.Log("ğŸ§ª Testing video system...");
            // videoManager.TestVideoLoading(); // Method not available in original
        }
        else
        {
            Debug.LogError("âŒ BackgroundVideoManager no encontrado");
        }
    }
    
    [ContextMenu("Show Setup Instructions")]
    public void ShowSetupInstructions()
    {
        Debug.Log("ğŸ“‹ INSTRUCCIONES DE CONFIGURACIÃ“N:");
        Debug.Log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
        Debug.Log("");
        Debug.Log("1ï¸âƒ£ MIGRACIÃ“N AUTOMÃTICA:");
        Debug.Log("   â€¢ Agregar VideoSystemMigrator a cualquier GameObject");
        Debug.Log("   â€¢ Ejecutar 'Migrate Video System'");
        Debug.Log("   â€¢ Â¡Todo se configura automÃ¡ticamente!");
        Debug.Log("");
        Debug.Log("2ï¸âƒ£ ESTRUCTURA DE ARCHIVOS:");
        Debug.Log("   StreamingAssets/Songs/[Cancion]/");
        Debug.Log("   â”œâ”€â”€ song.ogg");
        Debug.Log("   â”œâ”€â”€ notes.chart");
        Debug.Log("   â””â”€â”€ background.mp4  â† Video aquÃ­");
        Debug.Log("");
        Debug.Log("3ï¸âƒ£ FORMATOS RECOMENDADOS:");
        Debug.Log("   â€¢ MP4 (H.264) - MÃS RÃPIDO âš¡");
        Debug.Log("   â€¢ WebM - RÃ¡pido ğŸš€");
        Debug.Log("   â€¢ Evitar MOV/AVI - Lentos ğŸŒ");
        Debug.Log("");
        Debug.Log("4ï¸âƒ£ CONFIGURACIÃ“N:");
        Debug.Log("   â€¢ Videos se cargan automÃ¡ticamente");
        Debug.Log("   â€¢ Timeout de 5 segundos");
        Debug.Log("   â€¢ Opacidad 80% por defecto");
        Debug.Log("   â€¢ PosiciÃ³n de fondo completo");
    }
    
    void Update()
    {
        // Hotkeys for quick access
        if (Input.GetKeyDown(KeyCode.F11))
        {
            MigrateVideoSystem();
        }
        
        if (Input.GetKeyDown(KeyCode.F12))
        {
            TestVideoSystem();
        }
    }
    
    void OnGUI()
    {
        GUILayout.BeginArea(new Rect(Screen.width - 250, Screen.height - 100, 240, 80));
        GUILayout.Label("ğŸ”„ VIDEO SYSTEM MIGRATOR");
        GUILayout.Label("F11 - Migrate System");
        GUILayout.Label("F12 - Test Video System");
        GUILayout.EndArea();
    }
}
