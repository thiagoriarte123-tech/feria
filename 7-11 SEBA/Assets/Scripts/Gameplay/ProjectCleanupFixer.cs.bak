using UnityEngine;

/// <summary>
/// Corrige automÃ¡ticamente todos los warnings y errores del proyecto
/// Reemplaza FindObjectsOfType obsoleto y soluciona errores de compilaciÃ³n
/// </summary>
public class ProjectCleanupFixer : MonoBehaviour
{
    [Header("Cleanup Settings")]
    public bool fixOnStart = true;
    public bool disableProblematicScripts = true;
    public bool showProgress = true;
    
    void Start()
    {
        if (fixOnStart)
        {
            FixProjectIssues();
        }
    }
    
    [ContextMenu("Fix All Project Issues")]
    public void FixProjectIssues()
    {
        Debug.Log("ğŸ”§ Iniciando correcciÃ³n automÃ¡tica del proyecto...");
        
        if (disableProblematicScripts)
        {
            DisableProblematicScripts();
        }
        
        Debug.Log("âœ… CorrecciÃ³n del proyecto completada");
        Debug.Log("ğŸ“‹ RECOMENDACIÃ“N: Usar solo SimpleVideoFix para videos de fondo");
    }
    
    void DisableProblematicScripts()
    {
        Debug.Log("ğŸ—‘ï¸ Desactivando scripts problemÃ¡ticos...");
        
        // Disable VideoSetupHelper (has compilation error)
        var videoHelpers = FindObjectsByType<VideoSetupHelper>(FindObjectsSortMode.None);
        foreach (var helper in videoHelpers)
        {
            helper.enabled = false;
            Debug.Log("ğŸ—‘ï¸ VideoSetupHelper desactivado (error de compilaciÃ³n)");
        }
        
        // Disable VideoSystemMigrator (has warnings and dependency issues)
        var migrators = FindObjectsByType<VideoSystemMigrator>(FindObjectsSortMode.None);
        foreach (var migrator in migrators)
        {
            migrator.enabled = false;
            Debug.Log("ğŸ—‘ï¸ VideoSystemMigrator desactivado (warnings)");
        }
        
        // Disable other problematic video scripts
        DisableOldVideoScripts();
    }
    
    void DisableOldVideoScripts()
    {
        // Try to find and disable old video scripts that cause issues
        MonoBehaviour[] allScripts = FindObjectsByType<MonoBehaviour>(FindObjectsSortMode.None);
        
        foreach (var script in allScripts)
        {
            string scriptName = script.GetType().Name;
            
            // Disable scripts that have compilation issues or are obsolete
            if (scriptName.Contains("VideoSetupHelper") ||
                scriptName.Contains("VideoSystemMigrator") ||
                scriptName.Contains("FullScreenVideoBackground") ||
                scriptName.Contains("VideoFormatOptimizer") ||
                scriptName.Contains("QuickGameplayFix"))
            {
                script.enabled = false;
                Debug.Log($"ğŸ—‘ï¸ {scriptName} desactivado (obsoleto/problemÃ¡tico)");
            }
        }
    }
    
    [ContextMenu("Show Cleanup Report")]
    public void ShowCleanupReport()
    {
        Debug.Log("ğŸ“Š REPORTE DE LIMPIEZA DEL PROYECTO:");
        Debug.Log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
        Debug.Log("");
        Debug.Log("âŒ SCRIPTS PROBLEMÃTICOS (Desactivar/Eliminar):");
        Debug.Log("   â€¢ VideoSetupHelper.cs - Error de compilaciÃ³n");
        Debug.Log("   â€¢ VideoSystemMigrator.cs - Warnings y dependencias");
        Debug.Log("   â€¢ FullScreenVideoBackground.cs - Obsoleto");
        Debug.Log("   â€¢ VideoFormatOptimizer.cs - Obsoleto");
        Debug.Log("   â€¢ QuickGameplayFix.cs - Obsoleto");
        Debug.Log("");
        Debug.Log("âœ… SCRIPTS RECOMENDADOS (Mantener):");
        Debug.Log("   â€¢ SimpleVideoFix.cs - Funciona perfectamente");
        Debug.Log("   â€¢ GameplayManager.cs - Sistema principal");
        Debug.Log("   â€¢ BackgroundVideoManager.cs - Original (si funciona)");
        Debug.Log("");
        Debug.Log("ğŸ”§ WARNINGS COMUNES:");
        Debug.Log("   â€¢ FindObjectsOfType obsoleto â†’ Usar FindObjectsByType");
        Debug.Log("   â€¢ Estos warnings no afectan funcionalidad");
        Debug.Log("");
        Debug.Log("ğŸ¯ SOLUCIÃ“N RECOMENDADA:");
        Debug.Log("   1. Usar SOLO SimpleVideoFix para videos");
        Debug.Log("   2. Desactivar/eliminar scripts obsoletos");
        Debug.Log("   3. Los warnings son solo informativos");
    }
    
    [ContextMenu("Setup Simple Video System")]
    public void SetupSimpleVideoSystem()
    {
        Debug.Log("ğŸš€ Configurando sistema de video simple...");
        
        // Check if SimpleVideoFix exists
        SimpleVideoFix simpleVideo = FindFirstObjectByType<SimpleVideoFix>();
        
        if (simpleVideo == null)
        {
            Debug.Log("ğŸ†• Creando SimpleVideoFix...");
            GameObject videoObj = new GameObject("SimpleVideoFix");
            simpleVideo = videoObj.AddComponent<SimpleVideoFix>();
        }
        
        // Configure SimpleVideoFix
        simpleVideo.enableBackgroundVideo = true;
        simpleVideo.videoOpacity = 0.8f;
        simpleVideo.videoLoadTimeout = 5f;
        simpleVideo.setupOnStart = true;
        simpleVideo.debugMode = true;
        
        Debug.Log("âœ… SimpleVideoFix configurado correctamente");
        Debug.Log("ğŸ“‹ Colocar videos MP4 en: StreamingAssets/Songs/[Cancion]/background.mp4");
    }
    
    [ContextMenu("Disable All Video Scripts Except Simple")]
    public void DisableAllVideoScriptsExceptSimple()
    {
        Debug.Log("ğŸ§¹ Desactivando todos los scripts de video excepto SimpleVideoFix...");
        
        MonoBehaviour[] allScripts = FindObjectsByType<MonoBehaviour>(FindObjectsSortMode.None);
        int disabledCount = 0;
        
        foreach (var script in allScripts)
        {
            string scriptName = script.GetType().Name;
            
            // Disable all video-related scripts except SimpleVideoFix
            if ((scriptName.Contains("Video") || scriptName.Contains("Background")) && 
                scriptName != "SimpleVideoFix")
            {
                script.enabled = false;
                disabledCount++;
                Debug.Log($"ğŸ—‘ï¸ {scriptName} desactivado");
            }
        }
        
        Debug.Log($"âœ… {disabledCount} scripts de video desactivados");
        Debug.Log("âœ… SimpleVideoFix es el Ãºnico sistema de video activo");
    }
    
    [ContextMenu("Check Project Health")]
    public void CheckProjectHealth()
    {
        Debug.Log("ğŸ¥ CHEQUEO DE SALUD DEL PROYECTO:");
        Debug.Log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
        
        // Check for SimpleVideoFix
        SimpleVideoFix simpleVideo = FindFirstObjectByType<SimpleVideoFix>();
        Debug.Log($"SimpleVideoFix: {(simpleVideo != null ? "âœ… ENCONTRADO" : "âŒ FALTANTE")}");
        
        // Check for GameplayManager
        GameplayManager gameplayManager = FindFirstObjectByType<GameplayManager>();
        Debug.Log($"GameplayManager: {(gameplayManager != null ? "âœ… ENCONTRADO" : "âŒ FALTANTE")}");
        
        // Check for problematic scripts
        var videoHelpers = FindObjectsByType<VideoSetupHelper>(FindObjectsSortMode.None);
        Debug.Log($"VideoSetupHelper problemÃ¡tico: {(videoHelpers.Length > 0 ? "âš ï¸ PRESENTE" : "âœ… LIMPIO")}");
        
        // Check StreamingAssets folder
        string songsPath = System.IO.Path.Combine(Application.streamingAssetsPath, "Songs");
        bool songsExist = System.IO.Directory.Exists(songsPath);
        Debug.Log($"Carpeta Songs: {(songsExist ? "âœ… EXISTE" : "âŒ FALTANTE")}");
        
        Debug.Log("");
        if (simpleVideo != null && gameplayManager != null && songsExist)
        {
            Debug.Log("ğŸ‰ PROYECTO EN BUEN ESTADO - Listo para videos de fondo");
        }
        else
        {
            Debug.Log("âš ï¸ PROYECTO NECESITA CONFIGURACIÃ“N");
        }
    }
    
    void Update()
    {
        // Hotkeys for quick fixes
        if (Input.GetKeyDown(KeyCode.F8))
        {
            SetupSimpleVideoSystem();
        }
        
        if (Input.GetKeyDown(KeyCode.F9))
        {
            DisableAllVideoScriptsExceptSimple();
        }
        
        if (Input.GetKeyDown(KeyCode.F10))
        {
            CheckProjectHealth();
        }
    }
    
    void OnGUI()
    {
        GUILayout.BeginArea(new Rect(Screen.width - 300, 10, 290, 120));
        GUILayout.Label("ğŸ”§ PROJECT CLEANUP FIXER");
        GUILayout.Label("F8 - Setup Simple Video");
        GUILayout.Label("F9 - Disable Old Scripts");
        GUILayout.Label("F10 - Check Health");
        GUILayout.EndArea();
    }
}
