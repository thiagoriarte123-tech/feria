using UnityEngine;

/// <summary>
/// VersiÃ³n simplificada del migrador de sistema de video
/// Sin dependencias problemÃ¡ticas
/// </summary>
public class VideoSystemMigratorSimple : MonoBehaviour
{
    [Header("Migration Settings")]
    public bool autoMigrateOnStart = true;
    
    void Start()
    {
        if (autoMigrateOnStart)
        {
            MigrateVideoSystem();
        }
    }
    
    [ContextMenu("Migrate Video System")]
    public void MigrateVideoSystem()
    {
        Debug.Log("ğŸ”„ Iniciando migraciÃ³n del sistema de video...");
        
        SetupNewVideoSystem();
        ConnectToGameplayManager();
        
        Debug.Log("âœ… MigraciÃ³n del sistema de video completada");
    }
    
    void SetupNewVideoSystem()
    {
        Debug.Log("ğŸ†• Configurando nuevo sistema de video...");
        
        // Find or create BackgroundVideoManager
        BackgroundVideoManager newManager = FindFirstObjectByType<BackgroundVideoManager>();
        
        if (newManager == null)
        {
            GameObject managerObj = new GameObject("BackgroundVideoManager");
            newManager = managerObj.AddComponent<BackgroundVideoManager>();
            Debug.Log("ğŸ†• BackgroundVideoManager creado");
        }
        
        // Configure for optimal performance
        newManager.enableBackgroundVideo = true;
        newManager.videoOpacity = 0.8f;
        // newManager.videoLoadTimeout = 5f; // Not available in original
        // newManager.autoSetupOnStart = true; // Not available in original
        // newManager.debugMode = true; // Not available in original
        
        // Setup the video system
        // newManager.SetupVideoSystem(); // Not available in original
        
        Debug.Log("âœ… Nuevo sistema de video configurado");
    }
    
    void ConnectToGameplayManager()
    {
        Debug.Log("ğŸ”— Conectando con GameplayManager...");
        
        GameplayManager gameplayManager = FindFirstObjectByType<GameplayManager>();
        BackgroundVideoManager videoManager = FindFirstObjectByType<BackgroundVideoManager>();
        
        if (gameplayManager != null && videoManager != null)
        {
            gameplayManager.backgroundVideoManager = videoManager;
            Debug.Log("âœ… GameplayManager conectado con BackgroundVideoManager");
        }
        else
        {
            if (gameplayManager == null)
                Debug.LogWarning("âš ï¸ GameplayManager no encontrado");
            if (videoManager == null)
                Debug.LogWarning("âš ï¸ BackgroundVideoManager no encontrado");
        }
    }
    
    [ContextMenu("Test Video System")]
    public void TestVideoSystem()
    {
        Debug.Log("ğŸ§ª Probando sistema de video...");
        
        BackgroundVideoManager videoManager = FindFirstObjectByType<BackgroundVideoManager>();
        if (videoManager != null)
        {
            Debug.Log("ğŸ§ª Testing video system...");
            // videoManager.TestVideoLoading(); // Method not available in original
        }
        else
        {
            Debug.LogError("âŒ BackgroundVideoManager no encontrado");
        }
    }
    
    [ContextMenu("Show Setup Instructions")]
    public void ShowSetupInstructions()
    {
        Debug.Log("ğŸ“‹ INSTRUCCIONES DE CONFIGURACIÃ“N:");
        Debug.Log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
        Debug.Log("");
        Debug.Log("1ï¸âƒ£ MIGRACIÃ“N AUTOMÃTICA:");
        Debug.Log("   â€¢ Agregar VideoSystemMigratorSimple a cualquier GameObject");
        Debug.Log("   â€¢ Ejecutar 'Migrate Video System'");
        Debug.Log("   â€¢ Â¡Todo se configura automÃ¡ticamente!");
        Debug.Log("");
        Debug.Log("2ï¸âƒ£ ESTRUCTURA DE ARCHIVOS:");
        Debug.Log("   StreamingAssets/Songs/[Cancion]/");
        Debug.Log("   â”œâ”€â”€ song.ogg");
        Debug.Log("   â”œâ”€â”€ notes.chart");
        Debug.Log("   â””â”€â”€ background.mp4  â† Video aquÃ­");
        Debug.Log("");
        Debug.Log("3ï¸âƒ£ FORMATOS RECOMENDADOS:");
        Debug.Log("   â€¢ MP4 (H.264) - MÃS RÃPIDO âš¡");
        Debug.Log("   â€¢ WebM - RÃ¡pido ğŸš€");
        Debug.Log("   â€¢ Evitar MOV/AVI - Lentos ğŸŒ");
    }
    
    void Update()
    {
        // Hotkeys for quick access
        if (Input.GetKeyDown(KeyCode.F11))
        {
            MigrateVideoSystem();
        }
        
        if (Input.GetKeyDown(KeyCode.F12))
        {
            TestVideoSystem();
        }
    }
    
    void OnGUI()
    {
        GUILayout.BeginArea(new Rect(Screen.width - 250, Screen.height - 100, 240, 80));
        GUILayout.Label("ğŸ”„ VIDEO SYSTEM MIGRATOR");
        GUILayout.Label("F11 - Migrate System");
        GUILayout.Label("F12 - Test Video System");
        GUILayout.EndArea();
    }
}
